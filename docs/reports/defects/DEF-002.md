[← Back to baseline](../baseline.md)

# DEF-002 — Expired Deezer Preview Links in `/rankings`

## Summary  
Older Deezer preview URLs in `/rankings` fail to play, particularly for legacy accounts with aged ranking data. Freshly ranked songs work as expected, but older entries lose functionality over time.

## Environment  
- App: [melodx.io](melodx.io)
- commit: `9c876c9`
- Browser(s): `Firefox 142.0.1 (Desktop)`
- Device(s): `Windows 10 Desktop`
- Network: `Spectrum (approx 450 up / 11 down)`
- Date/Time: `09-14-2025`

## Preconditions  
- Legacy account with ranking data created months ago  
- Main QA account with recent rankings also available  

## Steps to Reproduce  
1. Login with the **Legacy QA account**.  
2. Navigate to `/rankings`.  
3. Scroll to older ranked entries.  
4. Attempt to play audio preview.  

## Expected Result  
Audio preview should load and play reliably for both new and old ranked entries.  

## Actual Result  
- Many older songs fail to play (expired Deezer preview links).  
- Inconsistent enrichment: sometimes new previews only appear after re-ranking additional songs.  
- Console logcs indicate attempt to refresh older songs, but results indicate failure.

## Impact  
- Returning users may find much of their rankings unplayable.  
- Undermines trust in the ranking history feature.  
- May lead to frustration and drop-off for long-term users.  

## Attachments   
- Screenshot/GIF: [DEF-002-legacy](../evidence/DEF-002-legacy.png) 
- Console log: [DEF-002-legacy-console](../evidence/DEF-002-legacy-console.txt) 

## Triage  
- Severity: Major  
- Priority: High  

## Suspected Areas  
- Deezer preview URLs expiring after a certain TTL (time-to-live).  
- Backend not refreshing metadata on `/rankings` load for older songs.  

## Diagnostics (what we tried)  
- Compared legacy vs. main QA account behavior.  
- Verified new rankings generate valid working preview links.  
- Observed enrichment failing to refresh on legacy account.  

## Proposed Fix (initial)  
- Implement backend enrichment step on `/rankings` load to refresh expired Deezer preview links.  
- Investigate Deezer API TTL policy and refresh cadence.  

---

**Owner:** `Michael DeReus`  
**Status:** `Open`   
**Opened:** `09-14-2025`  

### Linked Items  
- Risk: `R-05` (Deezer preview URL expiry breaks audio)  
- Test(s): `EXP-00`  

---

## Root Cause (fill after fix)  
<To be completed once confirmed. Likely tied to Deezer preview URL expiry and lack of refresh logic.>

## Fix Reference  
- Commit/PR: <link or ID after fix>  

## Verification Steps (post-fix)  
1. Re-run steps with legacy account on `/rankings`.  
2. Confirm all previews (old + new) play without issue.  
3. Capture HAR/screenshot/logs as fresh evidence.  

**Verified in:** commit `<sha>` / date `<YYYY-MM-DD>`  
**Verification Status:** <Pass/Fail>
